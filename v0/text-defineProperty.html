<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>测试数据劫持</title>
</head>
<body>
<div id='app'>
  <h1>{{name}}</h1>
</div>
</body>
<script type="text/javascript">
  function Observer(data, view) {
    this.view = view;
    var reg = /\{\{(.*)\}\}/;
    this.exp = reg.exec(this.view.innerHTML)[1];
    //设定初始值
    this.view.innerHTML = this.view.innerHTML.replace('{{' + this.exp + '}}', data[this.exp])

    Object.keys(data).forEach((key) => this.defineReactive(data, key, data[key]));
  }

  Observer.prototype = {
    defineReactive: function (data, key, val) {
      Object.defineProperty(data, key, {
        get: () => {
          console.log('劫持get方法 ', val);
          return val;
        },
        set: (newVal) => {
          console.log('劫持set方法', newVal);
          if (val === newVal) return;
          val = newVal;
          // this.view.innerHTML = newVal;
          this.view.innerHTML = this.view.innerHTML.replace('{{' + this.exp + '}}', newVal);
        }
      });
    }
  }

  var view = document.querySelector('#app');
  ;
  var model = {name: 'xxx'};
  new Observer(model, view);


</script>
</html>
